name: plotly dash enterprise deployment

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
    build:
      name: Build
      runs-on: ubuntu-latest
      steps:
      - name: Install SSH key of bastion
        uses: shimataro/ssh-key-action@v2
        with:
          key: ${{ secrets.SSH_DEPLOY_KEY }}
          known_hosts: '[dash-dev.selfservice.shell.ai]:3022'
#          config: ${{ secrets.CONFIG }} # ssh_config; optional
#          name: github_actions
          config: |
            Host dash-dev.selfservice.shell.ai
                Port 3022
#            IdentityFile /home/runner/.ssh/id_rsa
      - name: check ssh
        run: |
          ls -a /home/runner/.ssh/
          cat /home/runner/.ssh/config
          cat /home/runner/.ssh/known_hosts
          cat /home/runner/.ssh/id_rsa
      - name: Checkout current repo
        uses: actions/checkout@v2
        with:
          path: ./original_folder
      - name: Checkout Project B
        run: |
          ls ./original_folder
          mkdir ./plotly_project_folder
          cp -R ./original_folder/app.py ./plotly_project_folder
          cd ./plotly_project_folder
          git init
          git remote add plotly dokku@dash-dev.selfservice.shell.ai:mining-sites-dashboard
          git status
          git diff
          git add .
          git commit -m "commit from github action"
          git push plotly master
